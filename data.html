<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Data Paguyuban Citra Amarta</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet">
  <style>
    /* (CSS tetap, tidak berubah dari versi sebelumnya) */
    body {
      font-family: 'Nunito', sans-serif;
      background: linear-gradient(to right, #e0f7fa, #e8f5e9);
      margin: 0;
      padding: 40px 20px;
    }
    .container { max-width: 600px; margin: auto; background-color: white; padding: 30px; border-radius: 20px; box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15); position: relative; }
    h1 { text-align: center; color: #00796b; margin-bottom: 30px; }
    ul { list-style: none; padding: 0; margin: 0; }
    li { background-color: #f1f8e9; margin: 10px 0; padding: 15px 20px; border-left: 6px solid #00796b; border-radius: 10px; font-size: 1.1em; color: #333; cursor: pointer; }
    li:hover { background-color: #e8f5e9; transform: translateX(5px); }
    li a { color: inherit; text-decoration: none; display: block; }
    .submenu { overflow: hidden; max-height: 0; transition: max-height 0.4s ease; padding-left: 20px; }
    .submenu.show { max-height: 200px; }
    .submenu li { background-color: #e8f5e9; font-size: 1em; padding: 10px 15px; margin-top: 5px; }
    .back-button, .login-top button, #openChatBtn, #chatContainer button { border-radius: 8px; font-weight: bold; border: none; }
    .back-button { display: block; text-align: center; margin-top: 30px; background-color: #00796b; color: white; padding: 12px 20px; }
    .back-button:hover { background-color: #004d40; }
    .login-top { position: absolute; top: 20px; right: 30px; }
    .login-top button, #openChatBtn, #chatContainer button { background-color: #00796b; color: white; padding: 8px 16px; cursor: pointer; }
    .login-top button:hover, #openChatBtn:hover, #chatContainer button:hover { background-color: #004d40; }
    #floating-chatbox { position: fixed; bottom: 20px; right: 20px; z-index: 999; }
    #chatContainer { width: 300px; background: #fff; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.2); padding: 10px; margin-top: 10px; display: none; }
    #chatBoxContent { height: 200px; overflow-y: auto; border: 1px solid #ddd; padding: 8px; border-radius: 10px; margin-bottom: 10px; font-size: 14px; }
    #chatBoxContent .message { background: #e0f2f1; padding: 6px 8px; border-radius: 6px; margin-bottom: 10px; }
    #chatBoxContent .message strong { color: #004d40; display: block; }
    #chatBoxContent .message img { max-width: 100%; border-radius: 4px; margin-top: 5px; }
    #chatContainer input, #chatContainer textarea { width: 100%; padding: 6px; margin-bottom: 6px; font-size: 13px; border-radius: 6px; border: 1px solid #ccc; }
  </style>
</head>
<body>
  <div class="container">
    <div class="login-top">
      <button onclick="document.getElementById('loginModal').style.display='block'">üîê LOGIN ADMIN</button>
    </div>
    <h1>üè° PAGUYUBAN CITRA AMARTA</h1>
    <ul>
      <li><a href="tagihan.html">üìã Informasi Tagihan</a></li>
      <li onclick="toggleSubmenu()">üí∞ Informasi Keuangan</li>
      <ul class="submenu" id="submenuKeuangan">
        <li><a href="pemasukan.html">üì• Pemasukan</a></li>
        <li><a href="pengeluaran.html">üì§ Pengeluaran</a></li>
      </ul>
      <li>üèòÔ∏è Inventori Perumahan</li>
      <li>üå≥ Fasum dan Fasos</li>
      <li>üö™ Aturan Masuk Citra Amarta</li>
      <li>üë• Divisi Paguyuban Citra Marta</li>
    </ul>
    <a href="index.html" class="back-button">‚Üê Kembali ke Beranda</a>
  </div>

  <!-- Modal Login -->
  <div id="loginModal" class="modal" style="display:none; position:fixed; z-index:100; left:0; top:0; width:100%; height:100%; background-color:rgba(0,0,0,0.4);">
    <div class="modal-content" style="background:white; margin:15% auto; padding:20px; border-radius:12px; max-width:400px; box-shadow:0 8px 24px rgba(0,0,0,0.2);">
      <h3 style="text-align:center; color:#00796b;">Admin Paguyuban</h3>
      <input type="text" id="username" placeholder="Username">
      <input type="password" id="password" placeholder="Password">
      <div style="display:flex; justify-content: space-between;">
        <button onclick="login()">Login</button>
        <button onclick="document.getElementById('loginModal').style.display='none'">Batal</button>
      </div>
      <p id="loginStatus" style="color:red; text-align:center; margin-top:10px;"></p>
    </div>
  </div>

  <!-- Chatbox -->
  <div id="floating-chatbox">
    <button id="openChatBtn">üí¨ Aspirasi</button>
    <div id="chatContainer">
      <div style="display: flex; justify-content: space-between; font-weight: bold; margin-bottom: 10px; color: #00796b;">
        <span>Kotak Aspirasi</span>
        <button onclick="toggleChat(false)" style="background:none; border:none;">x</button>
      </div>
      <div id="chatBoxContent"></div>
      <input type="text" id="chatName" placeholder="Nama / Username (boleh anonim)">
      <textarea id="chatText" placeholder="Tulis aspirasi..."></textarea>
      <input type="file" id="chatImage" accept="image/*">
      <button onclick="kirimAspirasi()">Kirim</button>
    </div>
  </div>

  <script>
    function toggleSubmenu() {
      document.getElementById("submenuKeuangan").classList.toggle("show");
    }

    function login() {
      const user = document.getElementById('username').value.trim();
      const pass = document.getElementById('password').value.trim();
      const status = document.getElementById('loginStatus');
      if (user === "admin" && pass === "123456") {
        window.location.href = "admin.html";
      } else {
        status.innerText = "‚ùå Username atau Password salah!";
      }
    }

    function toggleChat(show) {
      const chatContainer = document.getElementById('chatContainer');
      chatContainer.style.display = (typeof show === "boolean") ? (show ? "block" : "none") : (chatContainer.style.display === "none" ? "block" : "none");
    }

    const nameInput = document.getElementById('chatName');

    function tampilkanChat(pesan) {
      const msgDiv = document.createElement('div');
      msgDiv.className = "message";
      msgDiv.innerHTML = `<strong>${pesan.nama}</strong>${pesan.teks}${pesan.gambar ? `<br><img src="${pesan.gambar}" />` : ""}`;
      document.getElementById('chatBoxContent').appendChild(msgDiv);
    }

    function kirimAspirasi() {
      const nama = nameInput.value.trim() || "Anonim";
      const teks = document.getElementById('chatText').value.trim();
      const gambarFile = document.getElementById('chatImage').files[0];
      if (!teks && !gambarFile) return;
      localStorage.setItem("aspirasiNama", nama);

      const submitToScript = (gambarURL = "") => {
        const formData = new FormData();
        formData.append("nama", nama);
        formData.append("aspirasi", teks);
        formData.append("gambar", gambarURL);
        fetch("https://script.google.com/macros/s/AKfycbx8_38EzUQPQh_NSABZWhRF9eBeZioEZhsIoGhdum-8TyzH4Z_c72iJQ29_GyprDNHsxQ/exec", {
          method: "POST",
          body: formData
        })
        .then(res => res.text())
        .then(() => {
          fetchChatData();
          document.getElementById('chatText').value = "";
          document.getElementById('chatImage').value = "";
        })
        .catch(err => {
          alert("Gagal kirim aspirasi.");
        });
      };

      if (gambarFile) {
        if (gambarFile.size > 1500000) return alert("Ukuran gambar maksimal 1.5 MB");
        const formDataImg = new FormData();
        formDataImg.append("image", gambarFile);
        fetch("https://api.imgbb.com/1/upload?key=40ee2c5d0fe71b0afdb293f91a003b2b", {
          method: "POST",
          body: formDataImg
        })
        .then(res => res.json())
        .then(data => {
          if (data && data.data && data.data.url) {
            submitToScript(data.data.url);
          } else throw new Error();
        })
        .catch(() => alert("Gagal upload gambar."));
      } else {
        submitToScript();
      }
    }

    function fetchChatData() {
      fetch("fetch("https://opensheet.elk.sh/1hSVZkfe5jRGyiI1Ww4SeisIpuhFmRNTGzAz0x8fg-dk/KotakAspirasi")
")
        .then(res => res.json())
        .then(data => {
          const chatBoxContent = document.getElementById('chatBoxContent');
          chatBoxContent.innerHTML = "";
          data.forEach(row => tampilkanChat({
            nama: row.nama,
            teks: row.aspirasi,
            gambar: row.gambar
          }));
        });
    }

    window.onload = function () {
      const savedName = localStorage.getItem("aspirasiNama");
      if (savedName) nameInput.value = savedName;
      fetchChatData();
      setInterval(fetchChatData, 10000);
    };

    document.getElementById('openChatBtn').onclick = () => toggleChat();

    window.onclick = function(e) {
      const modal = document.getElementById('loginModal');
      if (e.target === modal) modal.style.display = "none";
    };
  </script>
</body>
</html>
